{"ast":null,"code":"import _regeneratorRuntime from\"/home/jack/Desktop/Software Codebase/20210514 E-Commerce Version1/3d2021store/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/jack/Desktop/Software Codebase/20210514 E-Commerce Version1/3d2021store/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/jack/Desktop/Software Codebase/20210514 E-Commerce Version1/3d2021store/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from\"axios\";import{Row,Col,ListGroup,Image,Card,Button}from\"react-bootstrap\";import{Link}from\"react-router-dom\";import{useDispatch,useSelector}from\"react-redux\";import{PayPalButton}from\"react-paypal-button-v2\";import Loader from\"../components/Loader\";import Message from\"../components/Message\";import{getOrderDetails,payOrder,deliverOrder}from\"../actions/orderAction\";import{ORDER_PAY_RESET,ORDER_DELIVER_RESET}from\"../constants/orderConstants\";//                      This is a big mis-match, 20210520 one typo here\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function OrderScreen(_ref){var match=_ref.match,history=_ref.history;var orderId=match.params.id;console.log(\"orderId is \".concat(orderId));var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var _useSelector=useSelector(function(state){return state.orderDetails;}),order=_useSelector.order,loading=_useSelector.loading,error=_useSelector.error;var _useSelector2=useSelector(function(state){return state.orderPay;}),loadingPay=_useSelector2.loading,successPay=_useSelector2.success;//this is second bug for 20210520\nvar _useSelector3=useSelector(function(state){return state.orderDeliver;}),loadingDeliver=_useSelector3.loading,successDeliver=_useSelector3.success;//this is second bug for 20210520\nvar userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var dispatch=useDispatch();useEffect(function(){if(!userInfo){history.push(\"/login\");}var addPayPalScript=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"order screen paypal api\");_context.next=3;return axios(\"/api/config/paypal\");case 3:_yield$axios=_context.sent;clientId=_yield$axios.data;// sdk is software development kit? Insert 3-rd party script into HTML\nscript=document.createElement(\"script\");script.type=\"text/javascript\";script.async=true;script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.onload=function(){setSdkReady(true);};document.body.appendChild(script);console.log(\"script is ready\");case 12:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref2.apply(this,arguments);};}();console.log(\"order is \".concat(order));console.log(\"orderId is \".concat(orderId));// I reoganize this part, we do not need order here! otherwise it is infinite loop          \n// if (!order || successPay || successDeliver) {\nconsole.log(\"entering the dispatch section\");dispatch({type:ORDER_PAY_RESET});// IF you donot do this, it will not detect the delete  state change, then it won't re-render\ndispatch({type:ORDER_DELIVER_RESET});// \nconsole.log(\"going to dispatch \".concat(orderId));dispatch(getOrderDetails(orderId));if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}// } else if (!order.isPaid) {\n//     console.log(\"entering elseif\")\n//     \n//  } \n// // we want to reset the screen\n// if (!order || successPay || successDeliver) {\n//     dispatch({type: ORDER_PAY_RESET})\n//     dispatch({type: ORDER_DELIVER_RESET})\n//     dispatch(getOrderDetails(orderId))\n// } else if (!order.isPaid) {\n//     if (!window.paypal) {addPayPalScript()} else {setSdkReady(true)}\n// }\n},[orderId,dispatch,successPay,successDeliver]);var successPaymentHanlder=function successPaymentHanlder(paymentResult){console.log(\"paymentResult\",paymentResult);dispatch(payOrder(orderId,paymentResult));};var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order));};if(!loading&&!error){order.itemsPrice=order.orderItems.reduce(function(acc,item){return Number(acc+item.price*item.qty);},0);order.shippingPrice=order.itemsPrice<1000?Number((order.itemsPrice*0.1).toFixed(2)):0;}return loading?/*#__PURE__*/_jsx(Loader,{children:\" \"}):error?/*#__PURE__*/_jsxs(Message,{children:[\" \",error,\" \"]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\" Order \",order._id]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:8,children:[/*#__PURE__*/_jsxs(ListGroup,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\" Payment Method \"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\" Method: \"}),order.paymentMethod]}),order.isPaid?/*#__PURE__*/_jsxs(Message,{children:[\" Paid on \",order.paidAt,\" \"]}):/*#__PURE__*/_jsx(Message,{children:\" Not Paid\"})]}),/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\" Shipping \"}),/*#__PURE__*/_jsx(\"strong\",{children:\" Name: \"}),order.user&&order.user.name,order.user&&/*#__PURE__*/_jsx(\"a\",{href:\"mailto:\".concat(order.user.email),children:\"  \"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Address \",/*#__PURE__*/_jsx(\"br\",{}),order.shippingAddress.address,\", \",/*#__PURE__*/_jsx(\"br\",{}),order.shippingAddress.city,\",\",order.shippingAddress.postalCode,\",\",order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(Message,{variant:\"success\",children:[\" Delivered on \",order.deliveredAt]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\" Not Delivered \"})]}),/*#__PURE__*/_jsxs(ListGroup,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\" Order Items \"}),order.orderItems.length===0?/*#__PURE__*/_jsx(Message,{children:\" Your order is empty \"}):/*#__PURE__*/_jsx(ListGroup,{children:order.orderItems.map(function(item,index){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsx(Image,{src:item.image,alt:item.name,fluid:true})}),/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.product)}),item.name]}),/*#__PURE__*/_jsxs(Col,{md:4,children:[item.qty,\" x $\",item.price,\" = $\",(item.qty*item.price).toFixed(2)]})]})},index);})})]})]}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h2\",{children:\" Order Summary \"})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\" Items \"}),/*#__PURE__*/_jsxs(Col,{children:[\" $\",order.itemsPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\" 10% Shipping Fee (free for items over $1000) \"}),/*#__PURE__*/_jsxs(Col,{children:[\" $\",order.shippingPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\" Tax \"}),/*#__PURE__*/_jsxs(Col,{children:[\" $\",order.taxPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\" Total \"}),/*#__PURE__*/_jsxs(Col,{children:[\" $\",order.totalPrice]})]})}),!order.isPaid&&/*#__PURE__*/_jsxs(ListGroup.Item,{children:[loadingPay&&/*#__PURE__*/_jsx(Loader,{}),!sdkReady?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHanlder})]}),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"button\",className:\"btn btn-block\",onClick:deliverHandler,children:\"Mark As Delivered\"})})]})})})]})]});}// this <PayPal Button> must have some built-in like onClick = talk to paypal server\n// !!! WARNING: PayPalButton, not Paypal button\n// Here we only need to know on Success, it is going to pass us the paymentresult","map":{"version":3,"sources":["/home/jack/Desktop/Software Codebase/20210514 E-Commerce Version1/3d2021store/frontend/src/screens/OrderScreen.js"],"names":["React","useState","useEffect","axios","Row","Col","ListGroup","Image","Card","Button","Link","useDispatch","useSelector","PayPalButton","Loader","Message","getOrderDetails","payOrder","deliverOrder","ORDER_PAY_RESET","ORDER_DELIVER_RESET","OrderScreen","match","history","orderId","params","id","console","log","sdkReady","setSdkReady","state","orderDetails","order","loading","error","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","userLogin","userInfo","dispatch","push","addPayPalScript","clientId","data","script","document","createElement","type","async","src","onload","body","appendChild","isPaid","window","paypal","successPaymentHanlder","paymentResult","deliverHandler","itemsPrice","orderItems","reduce","acc","item","Number","price","qty","shippingPrice","toFixed","_id","paymentMethod","paidAt","user","name","email","shippingAddress","address","city","postalCode","country","isDelivered","deliveredAt","length","map","index","image","product","taxPrice","totalPrice","isAdmin"],"mappings":"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","sourcesContent":["import React , {useState, useEffect} from 'react'\nimport axios from \"axios\"\n\nimport {Row, Col, ListGroup, Image, Card, Button} from \"react-bootstrap\"\nimport {Link} from \"react-router-dom\"\nimport {useDispatch, useSelector} from \"react-redux\"\nimport {PayPalButton} from \"react-paypal-button-v2\"\n\nimport Loader from \"../components/Loader\"\nimport Message from \"../components/Message\"\nimport {getOrderDetails, payOrder, deliverOrder} from \"../actions/orderAction\" \nimport {ORDER_PAY_RESET, ORDER_DELIVER_RESET} from \"../constants/orderConstants\"\n//                      This is a big mis-match, 20210520 one typo here\n\n\nexport default function OrderScreen({match, history}) {\n\n    const orderId = match.params.id\n    console.log(`orderId is ${orderId}`)\n    const [sdkReady, setSdkReady] = useState(false)\n    const {order, loading, error} = useSelector(state => state.orderDetails)\n    const { loading : loadingPay, success: successPay} = useSelector(state => state.orderPay)  //this is second bug for 20210520\n    const { loading:  loadingDeliver, success: successDeliver} = useSelector(state => state.orderDeliver)  //this is second bug for 20210520\n\n    const userLogin = useSelector(state => state.userLogin)\n    const {userInfo} = userLogin\n\n    const dispatch = useDispatch()\n\n    useEffect(()=>{ \n            if (!userInfo) {history.push(\"/login\")}\n\n            const addPayPalScript = async() => {\n                console.log(\"order screen paypal api\")\n                const {data: clientId} = await axios(\"/api/config/paypal\")\n                // sdk is software development kit? Insert 3-rd party script into HTML\n                const script = document.createElement(\"script\")\n                script.type = \"text/javascript\"\n                script.async = true\n                script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`\n                script.onload = () => {setSdkReady(true)}\n                document.body.appendChild(script)\n                console.log(\"script is ready\")}\n\n            console.log(`order is ${order}`)\n            console.log(`orderId is ${orderId}`)\n\n            // I reoganize this part, we do not need order here! otherwise it is infinite loop          \n            \n            // if (!order || successPay || successDeliver) {\n            console.log(\"entering the dispatch section\")\n            dispatch({type: ORDER_PAY_RESET}) // IF you donot do this, it will not detect the delete  state change, then it won't re-render\n            dispatch({type: ORDER_DELIVER_RESET}) // \n            console.log(`going to dispatch ${orderId}`)\n            dispatch(getOrderDetails(orderId))\n\n            if (!order.isPaid) {if (!window.paypal) {addPayPalScript()} else {setSdkReady(true)}}\n            // } else if (!order.isPaid) {\n            //     console.log(\"entering elseif\")\n            //     \n            //  } \n\n                // // we want to reset the screen\n                // if (!order || successPay || successDeliver) {\n                //     dispatch({type: ORDER_PAY_RESET})\n                //     dispatch({type: ORDER_DELIVER_RESET})\n                //     dispatch(getOrderDetails(orderId))\n                // } else if (!order.isPaid) {\n                //     if (!window.paypal) {addPayPalScript()} else {setSdkReady(true)}\n                // }\n\n\n\n\n            }, [\n                orderId, \n                dispatch, \n                successPay, \n                successDeliver,\n                \n                ])\n\n\n\n    const successPaymentHanlder = (paymentResult) => {\n        console.log(\"paymentResult\", paymentResult)\n        dispatch(payOrder(orderId, paymentResult))\n    }\n\n    const deliverHandler = () => {\n        \n        dispatch(deliverOrder(order))\n    }\n\n    if (!loading && !error) {order.itemsPrice = order.orderItems.reduce((acc, item) => {return Number(acc + item.price * item.qty)}, 0)\n    order.shippingPrice = (order.itemsPrice < 1000 ? Number((order.itemsPrice * 0.1).toFixed(2)) : 0)}\n    \n\n\n    return (\n        loading? <Loader> </Loader> : error? <Message> {error} </Message> :\n        <div>\n        <h1> Order {order._id}</h1>\n            <Row>\n                    <Col md={8}>\n                        <ListGroup>\n                            <h2> Payment Method </h2>\n                            \n                            <p><strong> Method: </strong> \n                            {order.paymentMethod}</p>\n                            {order.isPaid?   <Message> Paid on {order.paidAt} </Message>  :  <Message> Not Paid</Message>  }\n                        \n                        </ListGroup>    \n\n\n                        <ListGroup variant=\"flush\">\n                            <h2> Shipping </h2>\n                            <strong> Name: </strong> \n                            {order.user && order.user.name}\n                            {order.user && <a href={`mailto:${order.user.email}`}>  </a>}\n                            \n                            <p> \n                                Address <br/>\n                                {order.shippingAddress.address}, <br/>\n                                {order.shippingAddress.city},  \n                                {order.shippingAddress.postalCode}, \n                                {order.shippingAddress.country} \n                            </p>\n                            {order.isDelivered? <Message variant=\"success\"> Delivered on {order.deliveredAt}</Message> : \n                            <Message variant=\"danger\"> Not Delivered </Message>}\n            \n                        </ListGroup>\n\n                                \n\n                        <ListGroup>\n                            <h2> Order Items </h2>\n                            {order.orderItems.length === 0 ? <Message> Your order is empty </Message> : (\n                                <ListGroup> \n                                    {order.orderItems.map((item, index)=>{return (\n                                        <ListGroup.Item key={index}>\n                                            <Row>\n                                                <Col md={1}>\n                                                    <Image src={item.image} alt={item.name} fluid />\n                                                </Col>\n                                                <Col >\n                                                    <Link to={`/product/${item.product}`}/>\n                                                    {item.name}\n                                                </Col>\n                                                <Col md={4}>\n                                                    {item.qty} x ${item.price} = ${(item.qty * item.price).toFixed(2)}\n                                                </Col> \n                                            </Row>\n                                        </ListGroup.Item>\n                                    )})}\n                                </ListGroup>\n                            )}\n                        </ListGroup>   \n                    </Col>\n\n                    <Col md={4}>\n                        <Card>\n                            <ListGroup variant=\"flush\">\n                                <ListGroup.Item>\n                                    <h2> Order Summary </h2>\n                                </ListGroup.Item>\n                                \n                                <ListGroup.Item>\n                                    <Row>\n                                        <Col> Items </Col>\n                                        <Col> ${order.itemsPrice}</Col>\n                                    </Row>\n                                </ListGroup.Item>\n                            \n                                <ListGroup.Item>\n                                    <Row>\n                                        <Col> 10% Shipping Fee (free for items over $1000) </Col>\n                                        <Col> ${order.shippingPrice}</Col>\n                                    </Row>\n                                </ListGroup.Item>\n\n                                <ListGroup.Item>\n                                    <Row>\n                                        <Col> Tax </Col>\n                                        <Col> ${order.taxPrice}</Col>\n                                    </Row>\n                                </ListGroup.Item>\n\n                                <ListGroup.Item>\n                                    <Row>\n                                        <Col> Total </Col>\n                                        <Col> ${order.totalPrice}</Col>\n                                    </Row>\n                                </ListGroup.Item>\n\n                                {!order.isPaid && (\n                                    <ListGroup.Item>\n                                        {loadingPay && <Loader/>}\n                                        {!sdkReady ? <Loader/>  : (<PayPalButton amount={order.totalPrice} onSuccess = {successPaymentHanlder}/> )}\n                                    </ListGroup.Item>)\n                                }\n\n                                \n                                {userInfo && userInfo.isAdmin && order.isPaid && !order.isDelivered && (\n                                    <ListGroup.Item>\n                                        <Button type=\"button\" className = \"btn btn-block\" onClick={deliverHandler}>\n                                            Mark As Delivered\n                                        </Button>\n                                    </ListGroup.Item>\n                                )}\n                            </ListGroup>                   \n                        </Card>                            \n                    </Col>\n                </Row>\n            </div>\n    )\n}\n\n// this <PayPal Button> must have some built-in like onClick = talk to paypal server\n// !!! WARNING: PayPalButton, not Paypal button\n// Here we only need to know on Success, it is going to pass us the paymentresult\n"]},"metadata":{},"sourceType":"module"}